{% extends "base.html" %}

{% block title %}{% if printer %}Edit{% else %}Add{% endif %} Printer - NexaAI{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="mb-8">
        <a href="/printers" class="text-purple-600 hover:text-purple-700 flex items-center space-x-2 mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            <span>Back to Printers</span>
        </a>
        <h1 class="text-4xl font-bold">{% if printer %}Edit{% else %}Add{% endif %} Printer</h1>
    </div>

    <div class="bg-white rounded-2xl shadow-lg p-8">
        <form method="POST" class="space-y-6">
            {% csrf_token %}
            
            <!-- Printer Name -->
            <div>
                <label for="name" class="block text-sm font-bold text-gray-700 mb-2">
                    Printer Name *
                </label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    required
                    value="{{ printer.name if printer else '' }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="e.g., My Prusa MK4"
                >
            </div>

            <!-- Printer Type -->
            <div>
                <label for="printer_type" class="block text-sm font-bold text-gray-700 mb-2">
                    Printer Type *
                </label>
                <select 
                    id="printer_type" 
                    name="printer_type"
                    required
                    onchange="toggleSnapmakerMode(this.value)"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                    <option value="prusa" {{ 'selected' if printer and printer.printer_type == 'prusa' else '' }}>Prusa (3D Print Only)</option>
                    <option value="snapmaker" {{ 'selected' if printer and printer.printer_type == 'snapmaker' else '' }}>Snapmaker (Multi-Mode)</option>
                </select>
            </div>

            <!-- Snapmaker Mode (only for Snapmaker) -->
            <div id="snapmaker_mode_field" style="display: {{ 'block' if printer and printer.printer_type == 'snapmaker' else 'none' }};">
                <label for="current_mode" class="block text-sm font-bold text-gray-700 mb-2">
                    Current Mode *
                </label>
                <select 
                    id="current_mode" 
                    name="current_mode"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                    <option value="3d_print" {{ 'selected' if printer and printer.current_mode == '3d_print' else '' }}>3D Printing</option>
                    <option value="cnc" {{ 'selected' if printer and printer.current_mode == 'cnc' else '' }}>CNC Milling</option>
                    <option value="laser" {{ 'selected' if printer and printer.current_mode == 'laser' else '' }}>Laser Engraving</option>
                </select>
            </div>

            <!-- Model -->
            <div>
                <label for="model" class="block text-sm font-bold text-gray-700 mb-2">
                    Model *
                </label>
                <input 
                    type="text" 
                    id="model" 
                    name="model" 
                    required
                    value="{{ printer.model if printer else '' }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="e.g., Prusa MK4, Snapmaker 2.0 A350"
                >
            </div>

            <!-- Serial Number -->
            <div>
                <label for="serial_number" class="block text-sm font-bold text-gray-700 mb-2">
                    Serial Number
                </label>
                <input 
                    type="text" 
                    id="serial_number" 
                    name="serial_number"
                    value="{{ printer.serial_number if printer else '' }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Optional"
                >
            </div>

            <!-- IP Address -->
            <div>
                <label for="ip_address" class="block text-sm font-bold text-gray-700 mb-2">
                    IP Address
                </label>
                <input 
                    type="text" 
                    id="ip_address" 
                    name="ip_address"
                    value="{{ printer.ip_address if printer else '' }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="e.g., 192.168.1.100"
                    pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$"
                >
            </div>

            <!-- Build Volume -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    Build Volume (mm) *
                </label>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label for="build_volume_x" class="block text-xs text-gray-600 mb-1">X (Width)</label>
                        <input 
                            type="number" 
                            id="build_volume_x" 
                            name="build_volume_x" 
                            required
                            value="{{ printer.build_volume_x if printer else '' }}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="250"
                            min="1"
                        >
                    </div>
                    <div>
                        <label for="build_volume_y" class="block text-xs text-gray-600 mb-1">Y (Depth)</label>
                        <input 
                            type="number" 
                            id="build_volume_y" 
                            name="build_volume_y" 
                            required
                            value="{{ printer.build_volume_y if printer else '' }}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="210"
                            min="1"
                        >
                    </div>
                    <div>
                        <label for="build_volume_z" class="block text-xs text-gray-600 mb-1">Z (Height)</label>
                        <input 
                            type="number" 
                            id="build_volume_z" 
                            name="build_volume_z" 
                            required
                            value="{{ printer.build_volume_z if printer else '' }}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="210"
                            min="1"
                        >
                    </div>
                </div>
            </div>

            <!-- Status -->
            <div>
                <label for="status" class="block text-sm font-bold text-gray-700 mb-2">
                    Status *
                </label>
                <select 
                    id="status" 
                    name="status"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                    <option value="idle" {{ 'selected' if printer and printer.status == 'idle' else '' }}>Idle</option>
                    <option value="printing" {{ 'selected' if printer and printer.status == 'printing' else '' }}>Printing</option>
                    <option value="offline" {{ 'selected' if printer and printer.status == 'offline' else '' }}>Offline</option>
                    <option value="error" {{ 'selected' if printer and printer.status == 'error' else '' }}>Error</option>
                </select>
            </div>

            <!-- Submit Button -->
            <div class="flex space-x-4">
                <button 
                    type="submit"
                    class="flex-1 bg-purple-600 text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-purple-700 transition"
                >
                    {{ 'Update Printer' if printer else 'Add Printer' }}
                </button>
                <a 
                    href="/printers"
                    class="px-8 py-4 border-2 border-gray-300 rounded-lg font-bold text-lg hover:bg-gray-50 transition"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function toggleSnapmakerMode(printerType) {
    const snapmakerField = document.getElementById('snapmaker_mode_field');
    if (printerType === 'snapmaker') {
        snapmakerField.style.display = 'block';
        document.getElementById('current_mode').required = true;
    } else {
        snapmakerField.style.display = 'none';
        document.getElementById('current_mode').required = false;
    }
}
</script>
{% endblock %}
